#!/bin/bash -e

export MSDeployPath=$(cygpath --windows $(dirname @msdeploy@))

case "$1" in
    activate)
        cd $2/Package
	script=$(ls *.deploy.cmd)
	$script /Y
	
	cd PackageTmp
	find . -type f ! -name "Web.config" | while read file
	do
	    dir="$(dirname $file)"
	    mkdir -p "$iisWwwRoot/$dir"
	    cp "$file" "$iisWwwRoot/$dir"	    
	done
        ;;
    deactivate)
        componentName=`basename $2`
	webappName=${componentName:33}
        @msdeploy@ -verb:delete -dest:iisapp="$webappName"
	;;
esac
